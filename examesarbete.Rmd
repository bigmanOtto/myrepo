---
title: "examensarbete"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r cars}
summary(cars)
```

## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.


install.packages("ggplot")
library(ggplot)

date = as.Date.character(TRACE_DAILY$trd_exctn_dt[1:502], format = "%Y%m%d")
price = TRACE_DAILY$price_avg[1:502]

ggplot(data = NULL, aes(x=date, y=price)) +
  geom_point(size = 0.5)
##bond1 AT&T
dbond=TRACE_PRICE[,8]
dbond1=unlist(dbond[1:502,1])
obs=(1:502)
price=TRACE_PRICE[,7]
price1=price[1:502,1]
vol=TRACE_PRICE[,6]
vol1=unlist(vol[1:502,1])

plot(date,dbond1)
line1 <- lm(dbond1~poly(obs,4,raw=TRUE))
lines(predict(line1),col="red")

plot(obs,unlist(price1))
plot(obs,vol1)

volLine<-lm(vol1~poly(obs,4,raw=TRUE))
lines(predict(volLine,col="red"))

bidask=TRACE_DAILY[,12]
bidask1=bidask[1:502,1]
plot(obs,unlist(bidask1))
lines(predict(baline,col="red"))
baline<-lm(unlist(bidask1)~poly(obs,4,raw=TRUE))

##bond2 AT&T
price2=price[503:1002,1]
dbond2=unlist(dbond[503:1002,1])
date2=as.Date.character(TRACE_DAILY$trd_exctn_dt[503:1002], format = "%Y%m%d")
plot(date2,dbond2)
line2 <- lm(dbond2~poly(date2,4,raw=TRUE))
lines(predict(line2),col="red")

plot(date2,unlist(price2))

bidask2=bidask[503:1002,1]
plot(obs2,unlist(bidask2))
lines(predict(baline2,col="red"))
baline2<-lm(unlist(bidask2)~poly(date2,4,raw=TRUE))

##bond3 Tesla
dbond3=unlist(dbond[76731:77206,1])
obs3=(1:476)
date3=s.Date.character(TRACE_DAILY$trd_exctn_dt[76731:77206], format = "%Y%m%d")

price3=price[76731:77206,1]


vol=TRACE_PRICE[,6]
vol3=unlist(vol[76731:77206,1])

plot(date3,dbond3)
line3 <- lm(dbond3~poly(obs3,4,raw=TRUE))
lines(predict(line3),col="red")

plot(date3,unlist(price3))
plot(date3,vol3)

volLine3<-lm(vol3~poly(obs3,4,raw=TRUE))

bidask3=bidask[76731:77206,1]
plot(obs3,unlist(bidask3))
lines(predict(baline3,col="red"))
baline3<-lm(unlist(bidask3)~poly(obs3,4,raw=TRUE))

<<<<<<< HEAD
##bond4

dbond4=unlist(dbond[76230:76730,1])
obs4=(1:501)
date4=s.Date.character(TRACE_DAILY$trd_exctn_dt[76731:77206], format = "%Y%m%d")

price4=price[76230:76730,1]



vol4=unlist(vol[76230:76730,1])

plot(obs4,dbond4)
line4 <- lm(dbond4~poly(obs4,4,raw=TRUE))
lines(predict(line4),col="red")

plot(obs4,unlist(price4))
plot(obs4,vol4)

volLine4<-lm(vol4~poly(obs4,4,raw=TRUE))

bidask4=bidask[76230:76730,1]
plot(obs4,unlist(bidask4))
lines(predict(baline4,col="red"))
baline4<-lm(unlist(bidask4)~poly(obs4,4,raw=TRUE))

##index corr

index=Index_data[,5]
index=unlist(index[1611:2112,1])

index<-as.numeric(index)

cor.test(dbond1,index)

#blir fel datum fÃ¶r dessa, 
cor.test(dbond2,index[1:500])
cor.test(dbond3,index[1:476])
cor.test(dbond4,index[1:501])

##coupon

coupon=TRACE_DAILY_1_[,5]

coupon1=unlist(coupon[1:502,1])

coupon1=as.numeric(coupon1)


#new data
dHY=unlist(DAILY_HY[,25])
mean(dHY)

dIG=unlist(DAILY_IG[,25])
mean(dIG)

##index correlation

dbond<-unlist(DAILY_all$d)
bondindex<-unlist(DAILY_all$spbond_close)
cor.test(dbond,bondindex)

cor.test(dbond[1:502],bondindex[1:502])

cor.test(dbond[503:1002],bondindex[503:1002])

cusip<-unlist(DAILY_all$cusip_id)

rating<-unlist(DAILY_all$credit)


data_frame<-data.frame(cusip ,dbond,bondindex)
ddply(data_frame,"cusip",summarise,
  corr=cor.test(dbond,bondindex))
  
data_frame1<-data.frame(rating ,dbond,bondindex)
ddply(data_frame1,"rating",summarise,
  corr=cor.test(dbond,bondindex))

## volume corr

vol<-unlist(DAILY_all$vol_tot)

data_frame2<-data.frame(cusip ,dbond,vol)

ddply(data_frame2,"rating",summarise,
  corr=cor.test(dbond,vol))

=======

adam = 1 
adam1 = 2
adam2 = 3 
>>>>>>> f10bead7f364f97fbb40eddcee834567ca06c669
